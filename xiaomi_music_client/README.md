# 小爱音乐控制器

基于Flutter开发的小爱同学音乐控制客户端，提供远程音乐播放控制功能。

## 功能特性

✅ **已完成功能 (完整版)**
- 🔐 **用户认证** - HTTP Basic Auth登录，自动保存凭据
- 🎵 **播放控制** - 播放/暂停、上一首/下一首、播放模式切换
- 🔊 **音量控制** - 实时音量调节和显示
- 📱 **设备管理** - 多设备选择和在线状态显示
- 📊 **播放状态** - 实时显示当前播放音乐信息和进度
- 🎨 **音乐封面** - 自动加载和缓存音乐封面图片
- 🔍 **音乐搜索** - 搜索并直接播放指定音乐
- 📋 **播放列表** - 创建、管理、播放自定义播放列表
- 🎼 **音乐库** - 浏览本地音乐文件，支持搜索和删除
- 🎚️ **播放进度** - 显示播放进度和时间信息
- 🔄 **播放模式** - 顺序、循环、随机、单曲循环模式切换

## 技术栈

- **框架**: Flutter 3.7+
- **状态管理**: Riverpod
- **网络请求**: Dio + HTTP Basic Auth
- **UI组件**: Material Design 3
- **图片缓存**: cached_network_image
- **本地存储**: shared_preferences
- **架构模式**: Clean Architecture

## 界面展示

### 📱 四个主要页面
1. **播放控制** - 音乐封面、播放控制、进度条、音量调节、播放模式
2. **搜索音乐** - 实时搜索、快速播放
3. **播放列表** - 列表管理、批量操作
4. **音乐库** - 本地音乐浏览、详细信息

### 🎛️ 播放控制功能
- ⏯️ 播放/暂停切换
- ⏮️⏭️ 上一首/下一首
- 🔀 播放模式: 顺序▶️循环▶️随机▶️单曲循环
- 🎚️ 播放进度条 (显示当前时间/总时长)
- 🔊 音量滑块控制

## 快速开始

### 1. 安装依赖
```bash
flutter pub get
```

### 2. 运行应用
```bash
# 在Chrome浏览器中运行
flutter run -d chrome

# 在移动设备上运行
flutter run

# 在macOS桌面运行
flutter run -d macos
```

## 使用说明

### 登录配置
1. 启动应用后进入登录页面
2. 输入小爱同学API服务器信息：
   - **服务器地址**: `192.168.31.2:58090`
   - **用户名**: API认证用户名
   - **密码**: API认证密码
3. 点击登录，应用会自动保存登录信息

### 功能使用

**🎵 播放控制**
- 选择设备后即可控制音乐播放
- 点击播放模式图标切换播放方式
- 拖动音量滑块调节音量
- 查看实时播放进度

**🔍 音乐搜索**
- 输入歌曲名、艺术家或关键词
- 点击搜索结果直接播放
- 支持实时搜索建议

**📋 播放列表管理**
- 创建新的播放列表
- 查看播放列表中的歌曲
- 播放整个列表或指定歌曲
- 删除不需要的播放列表

**🎼 音乐库浏览**
- 浏览服务器上的所有音乐文件
- 搜索筛选音乐
- 查看音乐详细信息
- 删除不需要的音乐文件

## 项目结构

```
lib/
├── core/                 # 核心功能
│   ├── constants/        # 常量定义
│   ├── errors/          # 错误处理
│   ├── network/         # 网络层
│   └── utils/           # 工具类
├── data/                # 数据层
│   ├── models/          # 数据模型 (音乐、设备、播放列表)
│   └── services/        # API服务
├── domain/              # 业务逻辑层
│   ├── entities/        # 业务实体
│   └── repositories/    # 仓库接口
└── presentation/        # 表现层
    ├── pages/           # 页面 (登录、主页、各功能页面)
    ├── providers/       # 状态管理 (Riverpod)
    └── widgets/         # UI组件
```

## API接口支持

支持完整的小爱同学音乐API：

**播放控制**
- `/getversion` - 版本信息
- `/playingmusic` - 当前播放状态
- `/cmd` - 播放控制命令
- `/playmusic` - 播放指定音乐

**音量和设备**
- `/getvolume` `/setvolume` - 音量控制
- `/getsetting` - 设备列表

**音乐管理**
- `/musiclist` - 音乐库
- `/searchmusic` - 音乐搜索
- `/delmusic` - 删除音乐
- `/musicinfo` - 音乐信息

**播放列表**
- `/playlistnames` - 播放列表
- `/playlistmusics` - 列表内容
- `/playmusiclist` - 播放列表
- `/playlistadd` `/playlistdel` - 列表管理

## 特色功能

### 🎨 用户体验
- **响应式设计** - 适配不同屏幕尺寸
- **实时状态** - 自动刷新播放状态
- **优雅错误处理** - 友好的错误提示和重试机制
- **加载状态** - 清晰的加载指示器
- **空状态页面** - 引导用户操作

### 🔧 技术特点
- **Clean Architecture** - 分层架构，易于维护
- **状态管理** - Riverpod提供响应式状态
- **网络优化** - 请求缓存和错误重试
- **图片缓存** - 自动缓存音乐封面
- **跨平台** - 支持Web、iOS、Android、macOS

## 故障排除

### 常见问题

**无法连接服务器**
- 检查服务器地址是否正确
- 确保设备在同一网络下
- 验证API服务是否正常运行

**认证失败**
- 检查用户名密码是否正确
- 确认API服务器开启了Basic Auth

**设备列表为空**
- 确保小爱设备已联网并正常工作
- 检查API服务器的设备发现功能

**播放控制无响应**
- 确保已选择正确的设备
- 检查设备是否在线
- 尝试刷新设备状态

## 开发计划

🔄 **后续功能规划**
- ⬇️ 音乐下载功能
- 🏷️ 音乐标签编辑
- 🎨 深色模式支持
- 📱 移动端UI优化
- 🔔 播放通知
- ⚙️ 更多设置选项

## 致谢

- Flutter团队提供的优秀框架
- Riverpod状态管理方案
- 小爱同学API支持
- Material Design组件库
